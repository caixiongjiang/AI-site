<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½ä½“ä½¿ç”¨ - çŸ¥è¯†æŒ‚è½½</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: #1A1A1A;
            color: #E0E0E0;
            overflow: hidden;
        }

        /* å·¦ä¾§å¯¼èˆªæ  */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 60px;
            height: 100vh;
            background: #252526;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 0;
            z-index: 1000;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: linear-gradient(135deg, #00B36B, #00D980);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 30px;
            cursor: pointer;
        }

        .nav-items {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .nav-item {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .nav-item:hover {
            background: rgba(0, 179, 107, 0.1);
        }

        .nav-icon {
            font-size: 20px;
        }

        .nav-bottom {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* ä¸‰æ å¸ƒå±€ */
        .main-layout {
            margin-left: 60px;
            height: 100vh;
            display: flex;
        }

        /* å·¦ä¾§é¢æ¿ï¼šä»£ç†åˆ—è¡¨ */
        .left-panel {
            width: 280px;
            background: #1E1E1E;
            border-right: 1px solid #333;
            display: flex;
            flex-direction: column;
        }

        .panel-header {
            padding: 20px;
            border-bottom: 1px solid #333;
        }

        .panel-title {
            font-size: 14px;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
        }

        .add-agent-btn {
            width: 100%;
            background: transparent;
            border: 1px dashed #00B36B;
            color: #00B36B;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s;
        }

        .add-agent-btn:hover {
            background: rgba(0, 179, 107, 0.1);
        }

        .agent-list {
            flex: 1;
            overflow-y: auto;
            padding: 12px;
        }

        .agent-item {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
            background: #252526;
        }

        .agent-item:hover {
            background: #2A2A2A;
        }

        .agent-item.active {
            background: rgba(0, 179, 107, 0.15);
            border-left: 3px solid #00B36B;
        }

        .agent-item-name {
            font-size: 14px;
            color: #E0E0E0;
            margin-bottom: 4px;
        }

        .agent-item-category {
            font-size: 12px;
            color: #888;
        }

        /* ä¸­é—´é¢æ¿ï¼šæ™ºèƒ½ä½“ä¿¡æ¯å’ŒçŸ¥è¯†ç®¡ç† */
        .middle-panel {
            flex: 1;
            background: #1A1A1A;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .agent-info {
            padding: 30px;
            border-bottom: 1px solid #333;
        }

        .agent-icon-large {
            width: 64px;
            height: 64px;
            border-radius: 16px;
            background: linear-gradient(135deg, rgba(0, 179, 107, 0.2), rgba(0, 217, 128, 0.1));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            margin-bottom: 20px;
        }

        .agent-name {
            font-size: 24px;
            font-weight: 400;
            margin-bottom: 8px;
        }

        .agent-category {
            font-size: 14px;
            color: #888;
            margin-bottom: 16px;
        }

        .agent-description {
            font-size: 14px;
            line-height: 1.6;
            color: #A0A0A0;
        }

        .agent-actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .action-icon-btn {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            background: #252526;
            border: none;
            color: #888;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .action-icon-btn:hover {
            background: #2A2A2A;
            color: #E0E0E0;
        }

        /* ä½¿ç”¨è¯´æ˜åŒºåŸŸ */
        .usage-section {
            padding: 30px;
            flex: 1;
        }

        .section-title {
            font-size: 16px;
            color: #E0E0E0;
            margin-bottom: 16px;
            font-weight: 500;
        }

        .usage-content {
            background: #252526;
            border-radius: 12px;
            padding: 24px;
            border: 1px solid #333;
        }

        .usage-item {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #333;
        }

        .usage-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .usage-label {
            font-size: 13px;
            color: #888;
            margin-bottom: 8px;
        }

        .usage-text {
            font-size: 14px;
            color: #C0C0C0;
            line-height: 1.6;
        }

        .usage-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .usage-tag {
            background: rgba(0, 179, 107, 0.15);
            border: 1px solid rgba(0, 179, 107, 0.3);
            color: #00D980;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 12px;
        }

        .capability-list {
            list-style: none;
            padding: 0;
        }

        .capability-list li {
            font-size: 14px;
            color: #C0C0C0;
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
        }

        .capability-list li::before {
            content: 'âœ“';
            position: absolute;
            left: 0;
            color: #00B36B;
            font-weight: bold;
        }

        /* å³ä¾§é¢æ¿ï¼šå¯¹è¯åŒº */
        .right-panel {
            width: 480px;
            background: #1E1E1E;
            border-left: 1px solid #333;
            display: flex;
            flex-direction: column;
        }

        .chat-header {
            padding: 20px;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-title {
            font-size: 16px;
            color: #E0E0E0;
        }

        .chat-actions {
            display: flex;
            gap: 8px;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        /* æ¶ˆæ¯æ°”æ³¡ */
        .message {
            display: flex;
            gap: 12px;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }

        .message-avatar.bot {
            background: linear-gradient(135deg, #00B36B, #00D980);
        }

        .message-avatar.user {
            background: #333;
        }

        .message-content {
            flex: 1;
        }

        .message-bubble {
            background: #252526;
            border-radius: 12px;
            padding: 12px 16px;
            margin-bottom: 8px;
            line-height: 1.6;
            font-size: 14px;
        }

        .message.user .message-bubble {
            background: rgba(0, 179, 107, 0.15);
        }

        .message-reference {
            font-size: 12px;
            padding: 8px 12px;
            background: rgba(0, 179, 107, 0.1);
            border-left: 3px solid #00B36B;
            border-radius: 0 6px 6px 0;
            margin-top: 8px;
        }

        .reference-link {
            color: #00D980;
            text-decoration: none;
            cursor: pointer;
        }

        .reference-link:hover {
            text-decoration: underline;
        }

        /* æŒ‚è½½çš„çŸ¥è¯†æºæ ‡ç­¾ */
        .mounted-sources {
            padding: 12px 20px;
            border-bottom: 1px solid #333;
            display: none;
        }

        .mounted-sources.show {
            display: block;
        }

        .mounted-label {
            font-size: 11px;
            color: #888;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .source-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .source-chip {
            background: rgba(0, 179, 107, 0.15);
            border: 1px solid rgba(0, 179, 107, 0.3);
            color: #00D980;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .source-chip:hover {
            background: rgba(0, 179, 107, 0.25);
            border-color: #00B36B;
        }

        .chip-icon {
            font-size: 14px;
        }

        .chip-remove {
            margin-left: 4px;
            opacity: 0.6;
            transition: opacity 0.2s;
        }

        .chip-remove:hover {
            opacity: 1;
        }

        /* è¾“å…¥åŒºåŸŸ */
        .chat-input-area {
            padding: 20px;
            border-top: 1px solid #333;
        }

        .input-toolbar {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .toolbar-btn {
            background: #252526;
            border: 1px solid #333;
            color: #888;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
        }

        .toolbar-btn:hover {
            background: #2A2A2A;
            border-color: #00B36B;
            color: #E0E0E0;
        }

        .chat-input-wrapper {
            background: #252526;
            border-radius: 12px;
            border: 2px solid transparent;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s;
        }

        .chat-input-wrapper:focus-within {
            border-color: #00B36B;
        }

        .chat-input {
            flex: 1;
            background: transparent;
            border: none;
            outline: none;
            color: #E0E0E0;
            font-size: 14px;
            font-family: inherit;
            resize: none;
            max-height: 120px;
        }

        .chat-input::placeholder {
            color: #666;
        }

        .chat-send-btn {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            background: #00B36B;
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .chat-send-btn:hover {
            background: #00D980;
        }

        .chat-send-btn:disabled {
            background: #333;
            color: #666;
            cursor: not-allowed;
        }

        /* æ¨¡æ€æ¡†ï¼šé€‰æ‹©çŸ¥è¯†æº */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            animation: fadeIn 0.2s;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal {
            background: #252526;
            border-radius: 16px;
            width: 90%;
            max-width: 700px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: slideUp 0.3s;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(40px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 24px;
            border-bottom: 1px solid #333;
        }

        .modal-title {
            font-size: 18px;
            color: #E0E0E0;
        }

        .modal-tabs {
            display: flex;
            gap: 24px;
            margin-top: 16px;
        }

        .modal-tab {
            padding: 8px 0;
            font-size: 14px;
            color: #888;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }

        .modal-tab:hover {
            color: #E0E0E0;
        }

        .modal-tab.active {
            color: #00B36B;
            border-bottom-color: #00B36B;
        }

        .modal-body {
            flex: 1;
            overflow-y: auto;
            padding: 20px 24px;
        }

        .modal-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 8px;
        }

        .modal-item:hover {
            background: rgba(0, 179, 107, 0.05);
        }

        .modal-checkbox {
            width: 18px;
            height: 18px;
            border: 2px solid #666;
            border-radius: 4px;
            cursor: pointer;
            position: relative;
            transition: all 0.2s;
        }

        .modal-checkbox.checked {
            background: #00B36B;
            border-color: #00B36B;
        }

        .modal-checkbox.checked::after {
            content: 'âœ“';
            position: absolute;
            color: white;
            font-size: 12px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .modal-item-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            background: rgba(0, 179, 107, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .modal-item-info {
            flex: 1;
        }

        .modal-item-name {
            font-size: 14px;
            color: #E0E0E0;
            margin-bottom: 2px;
        }

        .modal-item-meta {
            font-size: 12px;
            color: #888;
        }

        .modal-footer {
            padding: 20px 24px;
            border-top: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-count {
            font-size: 13px;
            color: #888;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
        }

        .modal-btn {
            padding: 10px 24px;
            border-radius: 8px;
            border: none;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .modal-btn.cancel {
            background: transparent;
            color: #888;
        }

        .modal-btn.cancel:hover {
            background: #2A2A2A;
            color: #E0E0E0;
        }

        .modal-btn.confirm {
            background: #00B36B;
            color: white;
        }

        .modal-btn.confirm:hover {
            background: #00D980;
        }

        .modal-btn.confirm:disabled {
            background: #333;
            color: #666;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <!-- å·¦ä¾§å¯¼èˆªæ  -->
    <div class="sidebar">
        <div class="user-avatar" title="ç”¨æˆ·ä¸­å¿ƒ">
            <span style="color: white; font-weight: bold;">è”¡</span>
        </div>

        <div class="nav-items">
            <div class="nav-item" title="é¦–é¡µ" onclick="location.href='index.html'">
                <span class="nav-icon">ğŸ </span>
            </div>
            <div class="nav-item" title="Agentåº”ç”¨" onclick="location.href='agent-center.html'">
                <span class="nav-icon">ğŸ¤–</span>
            </div>
            <div class="nav-item" title="çŸ¥è¯†åº“" onclick="location.href='knowledge-qa.html'">
                <span class="nav-icon">ğŸ“š</span>
            </div>
        </div>

        <div class="nav-bottom">
            <div class="nav-item" title="è®¾ç½®">
                <span class="nav-icon">âš™ï¸</span>
            </div>
            <div class="nav-item" title="å¸®åŠ©">
                <span class="nav-icon">â“</span>
            </div>
            <div class="nav-item" title="ä½œè€…ç®€ä»‹" onclick="alert('ä½œè€…ç®€ä»‹åŠŸèƒ½')">
                <span class="nav-icon">â„¹ï¸</span>
            </div>
        </div>
    </div>

    <!-- ä¸‰æ å¸ƒå±€ -->
    <div class="main-layout">
        <!-- å·¦ä¾§ï¼šä»£ç†åˆ—è¡¨ -->
        <div class="left-panel">
            <div class="panel-header">
                <div class="panel-title">ä»£ç†åˆ—è¡¨</div>
                <button class="add-agent-btn" onclick="location.href='agent-center.html'">+ æµè§ˆæ›´å¤šæ™ºèƒ½ä½“</button>
            </div>
            <div class="agent-list">
                <div class="agent-item active">
                    <div class="agent-item-name">ğŸ“„ åˆåŒé£é™©å®¡æŸ¥</div>
                    <div class="agent-item-category">æ³•åŠ¡ Â· é£é™©ç®¡ç†</div>
                </div>
                <div class="agent-item">
                    <div class="agent-item-name">ğŸ“Š å‘¨æŠ¥ç”Ÿæˆ</div>
                    <div class="agent-item-category">åŠå…¬æ•ˆç‡</div>
                </div>
                <div class="agent-item">
                    <div class="agent-item-name">ğŸŒ æ–‡æ¡£ç¿»è¯‘</div>
                    <div class="agent-item-category">è¯­è¨€å¤„ç†</div>
                </div>
                <div class="agent-item">
                    <div class="agent-item-name">ğŸ’» ä»£ç å®¡æŸ¥</div>
                    <div class="agent-item-category">å¼€å‘å·¥å…·</div>
                </div>
            </div>
        </div>

        <!-- ä¸­é—´ï¼šæ™ºèƒ½ä½“ä¿¡æ¯å’ŒçŸ¥è¯†ç®¡ç† -->
        <div class="middle-panel">
            <!-- æ™ºèƒ½ä½“ä¿¡æ¯ -->
            <div class="agent-info">
                <div class="agent-icon-large">ğŸ“„</div>
                <div class="agent-name" id="agentName">åˆåŒé£é™©å®¡æŸ¥</div>
                <div class="agent-category">æ³•åŠ¡ Â· é£é™©ç®¡ç†</div>
                <div class="agent-description" id="agentDescription">
                    åˆåŒé£é™©å®¡æŸ¥ï¼Œä¿®ç†å®¡æŸ¥åŠ©æ‰‹ã€‚è¯·å…ˆåœ¨å·¦ä¾§æŒ‚è½½æ‚¨çš„åˆåŒæ–‡ä»¶æˆ–ç›¸å…³çŸ¥è¯†åº“ï¼Œæˆ‘æ‰èƒ½å¼€å§‹ä¸ºæ‚¨åŠ å·¥ã€‚åˆåŒé£é™©å®¡æŸ¥æ¶µç›–çš„ç›¸å…³çŸ¥è¯†åº“ï¼Œæˆ‘æ‰å¼€å§‹ä¸ºæ‚¨å·¥ä½œã€‚
                </div>
                <div class="agent-actions">
                    <button class="action-icon-btn" title="ç¼–è¾‘">âœï¸</button>
                    <button class="action-icon-btn" title="åˆ é™¤">ğŸ—‘ï¸</button>
                </div>
            </div>

            <!-- ä½¿ç”¨è¯´æ˜ -->
            <div class="usage-section">
                <div class="section-title">ä½¿ç”¨è¯´æ˜</div>
                <div class="usage-content">
                    <div class="usage-item">
                        <div class="usage-label">ä¸»è¦åŠŸèƒ½</div>
                        <div class="usage-text">
                            è¯¥æ™ºèƒ½ä½“å¯ä»¥å¸®åŠ©æ‚¨å¿«é€Ÿè¯†åˆ«åˆåŒä¸­çš„æ½œåœ¨æ³•å¾‹é£é™©ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼šå…è´£æ¡æ¬¾ã€è¿çº¦è´£ä»»ã€çŸ¥è¯†äº§æƒä¿æŠ¤ã€æ•°æ®å®‰å…¨ç­‰å…³é”®å†…å®¹ã€‚
                        </div>
                    </div>

                    <div class="usage-item">
                        <div class="usage-label">ä½¿ç”¨æ–¹å¼</div>
                        <ul class="capability-list">
                            <li>åœ¨å³ä¾§å¯¹è¯æ¡†ä¸­ç›´æ¥ç²˜è´´åˆåŒå†…å®¹æˆ–æå‡ºé—®é¢˜</li>
                            <li>ç‚¹å‡»"æŒ‚è½½çŸ¥è¯†åº“"å¿«é€Ÿå…³è”æ‚¨çš„æ³•å¾‹æ–‡æ¡£åº“</li>
                            <li>ä¸Šä¼ åˆåŒæ–‡ä»¶è¿›è¡Œå…¨é¢åˆ†æ</li>
                            <li>æŸ¥çœ‹åˆ†æç»“æœå¹¶è·å–ä¸“ä¸šå»ºè®®</li>
                        </ul>
                    </div>

                    <div class="usage-item">
                        <div class="usage-label">é€‚ç”¨åœºæ™¯</div>
                        <div class="usage-tags">
                            <span class="usage-tag">åˆåŒå®¡æŸ¥</span>
                            <span class="usage-tag">é£é™©è¯„ä¼°</span>
                            <span class="usage-tag">æ³•å¾‹å’¨è¯¢</span>
                            <span class="usage-tag">æ¡æ¬¾å¯¹æ¯”</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å³ä¾§ï¼šå¯¹è¯åŒº -->
        <div class="right-panel">
            <div class="chat-header">
                <div class="chat-title">é—®ç­”</div>
                <div class="chat-actions">
                    <button class="action-icon-btn" title="æ–°å»ºå¯¹è¯">ğŸ’¬</button>
                    <button class="action-icon-btn" title="æ›´å¤š">â‹¯</button>
                </div>
            </div>

            <!-- å·²æŒ‚è½½çš„çŸ¥è¯†æºæ ‡ç­¾ -->
            <div class="mounted-sources" id="mountedSources">
                <div class="mounted-label">å·²æŒ‚è½½çš„çŸ¥è¯†æº (ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…)</div>
                <div class="source-chips" id="sourceChips">
                    <!-- æŒ‚è½½çš„çŸ¥è¯†æºæ ‡ç­¾ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ -->
                </div>
            </div>

            <div class="chat-messages" id="chatMessages">
                <!-- æ¬¢è¿æ¶ˆæ¯ -->
                <div class="message">
                    <div class="message-avatar bot">ğŸ¤–</div>
                    <div class="message-content">
                        <div class="message-bubble">
                            æ‚¨å¥½ï¼Œæˆ‘æ˜¯åˆåŒé£é™©å®¡æŸ¥åŠ©æ‰‹ã€‚è¯·å…ˆåœ¨å·¦ä¾§æŒ‚è½½æ‚¨çš„åˆåŒæ–‡ä»¶æˆ–ç›¸å…³çŸ¥è¯†åº“ï¼Œæˆ‘æ‰èƒ½å¼€å§‹ä¸ºæ‚¨å·¥ä½œã€‚
                        </div>
                    </div>
                </div>

                <!-- ç”¨æˆ·é—®é¢˜ç¤ºä¾‹ -->
                <div class="message user">
                    <div class="message-avatar user">ğŸ‘¤</div>
                    <div class="message-content">
                        <div class="message-bubble">
                            å¸®æˆ‘çœ‹çœ‹è¿™ä»½åˆåŒçš„å…è´£æ¡æ¬¾æœ‰é—®é¢˜å—ï¼Ÿ
                        </div>
                    </div>
                </div>

                <!-- AIå›å¤ç¤ºä¾‹ -->
                <div class="message">
                    <div class="message-avatar bot">ğŸ¤–</div>
                    <div class="message-content">
                        <div class="message-bubble">
                            æ‚¨å¥½ï¼Œæˆ‘æ˜¯åˆåŒé£é™©å®¡æŸ¥åŠ©æ‰‹ã€‚è¯·å…ˆåœ¨å·¦ä¾§æŒ‚è½½æ‚¨çš„åˆåŒæ–‡ä»¶æˆ–ç›¸å…³çŸ¥è¯†åº“ï¼Œæˆ‘æ‰èƒ½å¼€å§‹ä¸ºæ‚¨å·¥ä½œã€‚è¯·å‡†ä½åœ¨å·¦ä¾§æŒ‚è½½æ‚¨çš„åˆåŒæ–‡ä»¶æˆ–ç›¸å…³çŸ¥è¯†åº“ï¼Œæˆ‘æ‰èƒ½å¼€å§‹ä¸ºæ‚¨åŠ å·¥ã€‚è¯·å‡†ä½åœ¨å·¦ä¾§æŒ‚è½½æ‚¨çš„åˆåŒæ–‡ä»¶æˆ–ç›¸å…³çŸ¥è¯†åº“ï¼Œæˆ‘æ‰èƒ½å¼€å§‹ä¸ºæ‚¨åŠ å·¥ã€‚æ ¹æ®æ‚¨æä¾›çš„åˆåŒæ¶æ¶æï¼Œå…”è´£æ¡æ¬¾è¾ƒç°ä»¥ä¸‹é—®é¢˜ï¼Œå…¬å¸æ³•åŠ¡å…±äº«åº“è­¦è§‰æœ‰æœ¬äººæ‰€æ€§åˆåŒçš„å…”è´£ï¼Œå…”è´£æ¡æ¬¾åŠé—®é¢˜ä¹‹ä½œï¼Œå…¶æ¨æ™´åŠä¸€è·¯é™„èµ–å…”åˆåŒè‹‘æ–™ã€ä½åº”ï¼Œå…¬å¸æ³•åŠ¡ç­‰åˆåŒçš„å…”è´£è§‚æºï¼Œè¯·å‡†åˆåŒçš„è¾ƒè¡Œå…”åˆåŒçš„å…”è´£æ•°æ¬²ï¼ŒåˆåŒå…”è´£æ•°æ¬²æˆ–æ˜¯è¯‰æ³•æ­£ç¡®çš„åˆåŒçš„äº‹æƒ…ï¼Œè¯·å…ˆæ­£ç¡®çš„ä¿¡åé˜²æ¨çš„ï¼Œè€Œä¸”ä»¥å¤–å…¬å¸çš„æ¡æ¬²åˆåŒï¼Œå¹¶å¯ä»¥ä¸‹å…¶ä»–ç”¨å°å¸¸ï¼Œç”±æ™®é€‚å¸¸å…¬å¸æ¡çš„å…”è´£åˆåŒç³»æ¬²æˆ–çœ‹è¯‰æ³•æ­£ç¡®å…”ï¼Œè€Œä¸”ç»™äºˆå…”å¯¹å€Ÿè¡Œåç”¨ï¼Œå…¶å°†æ¡æƒåˆ†æ˜ç­‰ä¸€åˆ†çš„åˆåŒè§„åº“ï¼Œè¯¥è§„çƒæœˆçš„ï¼Œå¹¶åˆåŒæœŸå°±å…”è·å¾å…”æ¡¥å…”ç­‰è¡¨é™çš„æˆ–é—´è¯‰è¡Œååº”ã€‚
                        </div>
                        <div class="message-reference">
                            å¼•ç”¨è‡ªï¼š<a href="#" class="reference-link">[å…¬å¸æ³•åŠ¡å…±äº«åº“]</a> > <a href="#" class="reference-link">[æ ‡å‡†åˆåŒèŒƒæœ¬2023ç‰ˆ.pdf]</a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="chat-input-area">
                <!-- è¾“å…¥å·¥å…·æ  -->
                <div class="input-toolbar">
                    <button class="toolbar-btn" onclick="openMountModal()">
                        <span>ğŸ“š</span>
                        <span>æŒ‚è½½çŸ¥è¯†åº“</span>
                    </button>
                    <button class="toolbar-btn" onclick="uploadFile()">
                        <span>ğŸ“</span>
                        <span>ä¸Šä¼ æ–‡ä»¶</span>
                    </button>
                </div>

                <!-- è¾“å…¥æ¡† -->
                <div class="chat-input-wrapper">
                    <textarea 
                        class="chat-input" 
                        id="chatInput" 
                        placeholder="è¾“å…¥æ‚¨çš„é—®é¢˜ï¼Œæˆ–ç²˜è´´åˆåŒå†…å®¹..." 
                        rows="1"
                        onkeydown="handleChatKeydown(event)"
                    ></textarea>
                    <button class="chat-send-btn" onclick="sendChatMessage()">
                        â¤
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- æ¨¡æ€æ¡†ï¼šé€‰æ‹©çŸ¥è¯†æº -->
    <div class="modal-overlay" id="mountModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">æŒ‚è½½çŸ¥è¯†åº“/æ–‡ä»¶</div>
                <div class="modal-tabs">
                    <div class="modal-tab active" onclick="switchTab('knowledge')">æˆ‘çš„çŸ¥è¯†åº“</div>
                    <div class="modal-tab" onclick="switchTab('files')">å·¥ä½œç©ºé—´æ–‡ä»¶</div>
                </div>
            </div>

            <div class="modal-body" id="modalBody">
                <!-- çŸ¥è¯†åº“åˆ—è¡¨ -->
                <div id="knowledgeTab">
                    <div class="modal-item" onclick="toggleSelect(this)">
                        <div class="modal-checkbox"></div>
                        <div class="modal-item-icon">ğŸ“š</div>
                        <div class="modal-item-info">
                            <div class="modal-item-name">æŠ€æœ¯æ–‡æ¡£åº“</div>
                            <div class="modal-item-meta">89ä¸ªæ–‡ä»¶ Â· æœ€åæ›´æ–°: 1å°æ—¶å‰</div>
                        </div>
                    </div>

                    <div class="modal-item" onclick="toggleSelect(this)">
                        <div class="modal-checkbox"></div>
                        <div class="modal-item-icon">ğŸ“</div>
                        <div class="modal-item-info">
                            <div class="modal-item-name">äº§å“éœ€æ±‚æ–‡æ¡£</div>
                            <div class="modal-item-meta">45ä¸ªæ–‡ä»¶ Â· æœ€åæ›´æ–°: 3å¤©å‰</div>
                        </div>
                    </div>

                    <div class="modal-item" onclick="toggleSelect(this)">
                        <div class="modal-checkbox"></div>
                        <div class="modal-item-icon">ğŸ“„</div>
                        <div class="modal-item-info">
                            <div class="modal-item-name">æ³•å¾‹åˆè§„èµ„æ–™</div>
                            <div class="modal-item-meta">67ä¸ªæ–‡ä»¶ Â· æœ€åæ›´æ–°: 1å‘¨å‰</div>
                        </div>
                    </div>

                    <div class="modal-item" onclick="toggleSelect(this)">
                        <div class="modal-checkbox"></div>
                        <div class="modal-item-icon">ğŸ“Š</div>
                        <div class="modal-item-info">
                            <div class="modal-item-name">è´¢åŠ¡æŠ¥è¡¨æ±‡æ€»</div>
                            <div class="modal-item-meta">23ä¸ªæ–‡ä»¶ Â· æœ€åæ›´æ–°: 2å‘¨å‰</div>
                        </div>
                    </div>
                </div>

                <!-- æ–‡ä»¶åˆ—è¡¨ï¼ˆåˆå§‹éšè—ï¼‰ -->
                <div id="filesTab" style="display: none;">
                    <div class="modal-item" onclick="toggleSelect(this)">
                        <div class="modal-checkbox"></div>
                        <div class="modal-item-icon">ğŸ“„</div>
                        <div class="modal-item-info">
                            <div class="modal-item-name">2024å¹´åº¦åˆåŒ.pdf</div>
                            <div class="modal-item-meta">2.3 MB Â· ä¸Šä¼ äº: ä»Šå¤©</div>
                        </div>
                    </div>

                    <div class="modal-item" onclick="toggleSelect(this)">
                        <div class="modal-checkbox"></div>
                        <div class="modal-item-icon">ğŸ“Š</div>
                        <div class="modal-item-info">
                            <div class="modal-item-name">é¡¹ç›®è¿›åº¦è¡¨.xlsx</div>
                            <div class="modal-item-meta">456 KB Â· ä¸Šä¼ äº: æ˜¨å¤©</div>
                        </div>
                    </div>

                    <div class="modal-item" onclick="toggleSelect(this)">
                        <div class="modal-checkbox"></div>
                        <div class="modal-item-icon">ğŸ“</div>
                        <div class="modal-item-info">
                            <div class="modal-item-name">ä¼šè®®çºªè¦.docx</div>
                            <div class="modal-item-meta">128 KB Â· ä¸Šä¼ äº: 3å¤©å‰</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <div class="modal-count" id="selectedCount">å·²é€‰æ‹© 0 é¡¹</div>
                <div class="modal-actions">
                    <button class="modal-btn cancel" onclick="closeMountModal()">å–æ¶ˆ</button>
                    <button class="modal-btn confirm" id="confirmBtn" onclick="confirmMount()" disabled>ç¡®è®¤æŒ‚è½½</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // åˆå§‹åŒ–
        let selectedItems = new Set();
        let currentTab = 'knowledge';
        let mountedSources = []; // å­˜å‚¨å·²æŒ‚è½½çš„çŸ¥è¯†æº

        // ä»é¦–é¡µè·å–æ™ºèƒ½ä½“ä¿¡æ¯
        const agentName = sessionStorage.getItem('currentAgent');
        const initialMessage = sessionStorage.getItem('initialMessage');

        if (agentName) {
            document.getElementById('agentName').textContent = agentName;
        }

        // ä¸Šä¼ æ–‡ä»¶
        function uploadFile() {
            alert('ä¸Šä¼ æ–‡ä»¶åŠŸèƒ½ï¼ˆå°†æ‰“å¼€æ–‡ä»¶é€‰æ‹©å™¨ï¼‰');
        }

        // æ‰“å¼€æŒ‚è½½æ¨¡æ€æ¡†
        function openMountModal() {
            document.getElementById('mountModal').classList.add('show');
            selectedItems.clear();
            updateSelectedCount();
        }

        // å…³é—­æŒ‚è½½æ¨¡æ€æ¡†
        function closeMountModal() {
            document.getElementById('mountModal').classList.remove('show');
        }

        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tab) {
            currentTab = tab;
            const tabs = document.querySelectorAll('.modal-tab');
            tabs.forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');

            document.getElementById('knowledgeTab').style.display = tab === 'knowledge' ? 'block' : 'none';
            document.getElementById('filesTab').style.display = tab === 'files' ? 'block' : 'none';

            selectedItems.clear();
            document.querySelectorAll('.modal-checkbox').forEach(cb => cb.classList.remove('checked'));
            updateSelectedCount();
        }

        // åˆ‡æ¢é€‰æ‹©
        function toggleSelect(item) {
            const checkbox = item.querySelector('.modal-checkbox');
            const name = item.querySelector('.modal-item-name').textContent;
            
            if (checkbox.classList.contains('checked')) {
                checkbox.classList.remove('checked');
                selectedItems.delete(name);
            } else {
                checkbox.classList.add('checked');
                selectedItems.add(name);
            }
            
            updateSelectedCount();
        }

        // æ›´æ–°é€‰ä¸­æ•°é‡
        function updateSelectedCount() {
            const count = selectedItems.size;
            document.getElementById('selectedCount').textContent = `å·²é€‰æ‹© ${count} é¡¹`;
            document.getElementById('confirmBtn').disabled = count === 0;
        }

        // ç¡®è®¤æŒ‚è½½
        function confirmMount() {
            selectedItems.forEach(name => {
                // æ·»åŠ åˆ°å·²æŒ‚è½½åˆ—è¡¨
                if (!mountedSources.find(s => s.name === name)) {
                    const isKB = currentTab === 'knowledge';
                    mountedSources.push({
                        name: name,
                        type: isKB ? 'kb' : 'file',
                        icon: isKB ? 'ğŸ“š' : 'ğŸ“„'
                    });
                }
            });

            updateMountedChips();
            closeMountModal();
        }

        // æ›´æ–°å·²æŒ‚è½½çš„æ ‡ç­¾æ˜¾ç¤º
        function updateMountedChips() {
            const chipsContainer = document.getElementById('sourceChips');
            const mountedSection = document.getElementById('mountedSources');
            
            if (mountedSources.length === 0) {
                mountedSection.classList.remove('show');
                return;
            }

            mountedSection.classList.add('show');
            chipsContainer.innerHTML = '';

            mountedSources.forEach((source, index) => {
                const chip = document.createElement('div');
                chip.className = 'source-chip';
                chip.innerHTML = `
                    <span class="chip-icon">${source.icon}</span>
                    <span>${source.name}</span>
                    <span class="chip-remove" onclick="event.stopPropagation(); removeSource(${index})">âœ•</span>
                `;
                
                // ç‚¹å‡»æ ‡ç­¾è·³è½¬åˆ°çŸ¥è¯†åº“é—®ç­”é¡µé¢
                chip.onclick = function(e) {
                    if (!e.target.classList.contains('chip-remove')) {
                        const kbName = source.type === 'kb' ? source.name : '';
                        const fileName = source.type === 'file' ? source.name : '';
                        window.location.href = `knowledge-qa.html?kb=${encodeURIComponent(kbName || 'çŸ¥è¯†åº“')}&file=${encodeURIComponent(fileName)}`;
                    }
                };
                
                chipsContainer.appendChild(chip);
            });
        }

        // ç§»é™¤å·²æŒ‚è½½çš„çŸ¥è¯†æº
        function removeSource(index) {
            if (confirm('ç¡®å®šè¦ç§»é™¤è¿™ä¸ªçŸ¥è¯†æºå—ï¼Ÿ')) {
                mountedSources.splice(index, 1);
                updateMountedChips();
            }
        }

        // å‘é€èŠå¤©æ¶ˆæ¯
        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;

            const messagesContainer = document.getElementById('chatMessages');
            
            // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
            const userMsg = document.createElement('div');
            userMsg.className = 'message user';
            userMsg.innerHTML = `
                <div class="message-avatar user">ğŸ‘¤</div>
                <div class="message-content">
                    <div class="message-bubble">${message}</div>
                </div>
            `;
            messagesContainer.appendChild(userMsg);

            // æ¸…ç©ºè¾“å…¥æ¡†
            input.value = '';
            input.style.height = 'auto';

            // æ¨¡æ‹ŸAIå›å¤
            setTimeout(() => {
                const botMsg = document.createElement('div');
                botMsg.className = 'message';
                botMsg.innerHTML = `
                    <div class="message-avatar bot">ğŸ¤–</div>
                    <div class="message-content">
                        <div class="message-bubble">
                            æ­£åœ¨åˆ†ææ‚¨çš„é—®é¢˜ï¼Œè¯·ç¨å€™...
                        </div>
                    </div>
                `;
                messagesContainer.appendChild(botMsg);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }, 500);
        }

        // å¤„ç†å›è½¦å‘é€
        function handleChatKeydown(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendChatMessage();
            }
        }

        // è‡ªåŠ¨è°ƒæ•´è¾“å…¥æ¡†é«˜åº¦
        document.getElementById('chatInput').addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = this.scrollHeight + 'px';
        });

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        document.getElementById('mountModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeMountModal();
            }
        });
    </script>
</body>
</html>
